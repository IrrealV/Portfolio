---
import type { Experience, Education } from '../../types/portfolio';

interface Props {
  items: (Experience | Education)[];
  type: 'experience' | 'education';
}

const { items, type } = Astro.props;

function isExperience(item: Experience | Education): item is Experience {
  return 'company' in item;
}

// Generate unique IDs for hover functionality
const timelineId = `timeline-${type}-${Date.now()}`;
---

<div class="horizontal-timeline">
  <!-- Timeline Track -->
  <div class="relative">
    <!-- Timeline Items Container -->
    <div class="flex gap-1 overflow-x-auto pb-4 scrollbar-hide relative">
      <!-- Horizontal line that goes THROUGH the dots -->
      <div class="absolute top-[5px] left-0 right-0 h-px bg-(--color-border) z-0"></div>
      
      {items.map((item, index) => (
        <div
          class="timeline-item group shrink-0 pt-8 px-3 text-left min-w-[140px] max-w-[180px] relative"
          data-target={`${timelineId}-${index}`}
          data-timeline={timelineId}
        >
          <!-- Dot (on top of line) -->
          <div class="absolute top-0 left-1/2 -translate-x-1/2 w-2.5 h-2.5 rounded-full bg-(--color-bg) border-2 border-(--color-border) group-hover:border-(--color-accent) group-hover:bg-(--color-accent) transition-colors z-10"></div>
          
          <!-- Period -->
          <span class="block text-xs text-(--color-text-muted) mb-1 truncate">
            {isExperience(item) ? item.period.split('–')[0] : item.period.split('–')[0]}
          </span>
          
          <!-- Title -->
          <span class="block text-sm font-medium text-(--color-text-secondary) group-hover:text-(--color-accent) transition-colors line-clamp-2 cursor-default">
            {isExperience(item) ? item.company : item.institution}
          </span>
          
          <!-- Hover Content Panel -->
          <div
            class="timeline-content absolute left-0 top-full mt-2 w-64 p-4 rounded-lg bg-(--color-bg-secondary) border border-(--color-border) shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-20"
          >
            <div class="space-y-2">
              <div class="flex items-start justify-between gap-2">
                <h4 class="font-semibold text-(--color-text) text-sm">
                  {isExperience(item) ? item.title : item.degree}
                </h4>
              </div>
              
              <p class="text-xs text-(--color-text-muted)">
                {isExperience(item) ? item.period : item.period}
              </p>
              
              <p class="text-sm text-(--color-text-secondary)">
                {isExperience(item) ? `${item.company} · ${item.location}` : item.institution}
              </p>
              
              {item.description && (
                <p class="text-xs text-(--color-text-muted)">
                  {item.description}
                </p>
              )}
              
              {isExperience(item) && item.bullets.length > 0 && (
                <ul class="mt-2 space-y-1">
                  {item.bullets.slice(0, 2).map((bullet) => (
                    <li class="text-xs text-(--color-text-muted) flex items-start gap-2">
                      <span class="text-(--color-accent) mt-0.5">•</span>
                      {bullet}
                    </li>
                  ))}
                </ul>
              )}
            </div>
          </div>
        </div>
      ))}
    </div>
  </div>
</div>

<style>
  .scrollbar-hide {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }
  
  /* Ensure hover panels don't get clipped */
  .horizontal-timeline {
    overflow: visible;
  }
  
  .timeline-item {
    position: relative;
  }
  
  .timeline-content {
    pointer-events: none;
  }
  
  .timeline-item:hover .timeline-content {
    pointer-events: auto;
  }
</style>
