---
import type { Experience, Education } from '../../types/portfolio';
import TimelinePanel from './TimelinePanel.astro';

interface Props {
  items: (Experience | Education)[];
  type: 'experience' | 'education';
}
const { items, type } = Astro.props;
const id = `timeline-${type}`,
  reversed = [...items].reverse();
const isExp = (i: Experience | Education): i is Experience => 'company' in i;
const endDate = (p: string) => p.split('â€“')[1]?.trim() || 'Actual';
---

<div class="timeline-wrapper" id={id}>
  <div class="overflow-x-auto pb-4 scrollbar-hide">
    <div class="flex gap-1 relative min-w-max">
      <div
        class="absolute top-[5px] left-0 right-0 h-px bg-(--color-border) z-0"
      >
      </div>
      {
        reversed.map((item, i) => (
          <button
            type="button"
            class="timeline-item group shrink-0 pt-8 px-2 text-left min-w-[110px] max-w-[140px] relative cursor-pointer bg-transparent border-none"
            data-index={i}
            aria-expanded="false"
          >
            <div class="absolute top-0 left-1/2 -translate-x-1/2 w-3 h-3 rounded-full bg-(--color-bg) border-2 border-(--color-border) group-hover:border-(--color-accent) group-hover:bg-(--color-accent) transition-all z-10" />
            <span class="block text-xs text-(--color-text-muted) mb-1">
              {endDate(item.period)}
            </span>
            <span class="block text-sm font-medium text-(--color-text-secondary) group-hover:text-(--color-accent) line-clamp-2">
              {isExp(item) ? item.company : item.institution}
            </span>
          </button>
        ))
      }
    </div>
  </div>
  <div class="panels-container relative mt-2">
    {reversed.map((item, i) => <TimelinePanel item={item} index={i} id={id} />)}
  </div>
</div>

<style>
  .scrollbar-hide {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }
</style>

<script>
  import { initTimelines } from '../../scripts/timeline';
  document.addEventListener('astro:page-load', initTimelines);
</script>
